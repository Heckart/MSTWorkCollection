; CTCTimerExample.asm
;
; F = 8 MHZ
; tMC = (1cc/1MC)(1/8(10^6) = 0.125 us
; 
; tdelay = 20 us
; n = tdelay/tMC = 20 us/0.125 us = 160

.ORG 0
LDI R16, HIGH(RAMEND)
OUT SPH, R16
LDI R16, LOW(RAMEND)
OUT SPL, R16

SBI DDRB, 2
LDI R17, 0x00
LDI R16, 0x04

LDI R20, 0
OUT TCNT0, R20
LDI R20, 159
OUT OCR0, R20



MAIN:    
OUT PORTB, R17
RCALL DELAY
EOR R17, R16
RJMP MAIN

.ORG 0x100
DELAY:
LDI R20, 0X09; 00001001
OUT TCCR0, R20
AGAIN: IN R20, TIFR
SBRS R20, OCF0; NOT TOV0
RJMP AGAIN; GO UNTIL COMPARE MATCH OFC0 = 1 (OCR0 = TCNT0)
LDI R20, 0X00
OUT TCCR0, R20; TURN OFF TIMER
LDI R20, 1<<OCF0; 0000 0010
OUT TIFR, R20; CLEAR OCF0 FLAG
RET
